# Forest Arborist

Provide convenient operations on a forest of repositories. The forest can be nested under a main repo or siblings in a plain directory. Support both Git and Mercurial repositories. Inspired by experience with Mercurial subrepositories.

Uses a configuration file in the main repo and a marker file at the root of the forest. Allow commands to be run from anywhere in the forest, by searching up for the root marker file.

Terminology
* forest: a collection of repos and their working trees.
* root: directory at the root of the forest.
* main repo: where the manifest is stored

## Configuration File Format (arm.json)

The config file can be automatically generated by:
* `fab init` from master repository for a nested forest
* `fab init --root ..` from main repo for a sibling forest

arm.json specifies working directory names and origin repositories for forest, relative to root. Origin supports paths relative to main repo. Dependent repos can be pinned to a revision (pinRevision), locked to a branch (lockBranch), or free and use the same branch as the main repo when specified for clone.

    {
      "dependencies": {
        "TestRenamed": {
          "origin": "git@github.com:JohnRGee/Test.git",
          "repoType": "git"
        }
      },
      "rootDirectory": ".."
    }

## Usage

    Usage: fab [options] [command]


    Commands:

      clone [options] <source> [destination]        clone source and install its dependencies
      init [options]                                add manifest in current directory, and marker file at root of forest
      install [options]                             clone missing (new) dependent repositories
      status                                        show concise status for each repo in the forest
      pull                                          git-style pull, which is fetch and merge
      outgoing                                      show new changesets that have not been pushed
      root                                          show the root directory of the forest
      for-each [command...]                         run specified command on each repo in the forest, e.g. "fab foreach -- pwd"
      for-free [command...]                         run specified command on repos which are not locked or pinned
      switch <branch>                               switch branch of free repos
      make-branch [options] <branch> [start_point]  create new branch in free repos
      snapshot|ss                                   display state of forest
      recreate <snapshot> [destination]             clone repos to recreate forest in past state
      \_restore <snapshot>                            checkout repos to restore forest in past state

    Options:

      -h, --help     output usage information
      -V, --version  output the version number

    Files:
    arm.json manifest file for forest
    .arm-root.json marks root of forest (do not commit to VCS)

    Forest management: clone, init, install
    Utility: status, pull, outgoing, for-each, for-free
    Branch: make-branch, switch
    Reproducible state: snapshot, recreate, restore

    Commands starting with an underscore are still in development.
    See https://github.com/JohnRGee/forest-arborist.git for usage overview.
    See also 'fab <command> --help' for command options and further help.

## Example Usage

(ToDo) Examples of forest management, utility, branch, and reproducible state.

## Installing

Requires node and npm. Easy install:

    npm install --global @shadowspawn/arm

For more flexibility during development:

    git clone https://github.com/JohnRGee/forest-arborist.git
    cd forest-arborist
    npm install
    npm link

## Status

Pre-release. Still in flux, breaking changes coming:
* renaming package from arm to forest-arborist (fab)
* changes to support multiple manifests

"fab init" is great for trying out on an existing checkout.

Main development on Mac OS X. Targeting also Microsoft Windows and Linux.
